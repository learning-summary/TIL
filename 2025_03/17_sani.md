# 결제 도메인 지식 - PG, VAN 이해
    
    https://brunch.co.kr/@b8d3c346c3af4dc/4
    
    - VAN
        - 옛날엔 카드사별로 다른 단말기를 통해 결제해야했으나, 이를 통합한 단말기 제공하고 각 카드-가맹점 사이 계약 도와주며 수수료 떼어가는 방식
        *ex) KCP, 나이스정보통신, KIS정보통신 등*
    - VAN의 오프라인 결제 구조

        ![image](https://github.com/user-attachments/assets/8c8e05bb-e320-4712-a3f4-c1352b08464f)
        1. 사용자가 카드 긁음
        2. 카드사로부터 한도 조회. 한도 남아있으면, 결제 승인 및 영수증 발행
        3. VAN 사에서 하루동안 승인 내역 보관하다 카드사(매입사)에 ‘매입’ 보냄. (그래서 당일 취소건은 당일 취소 가능한 것)
        4. 카드사는 매입된 정보로 월별 청구](attachment:6afc3afb-0df9-4246-8ac7-610cf8a0d71f:image.png)
        
        1. 사용자가 카드 긁음
        2. 카드사로부터 한도 조회. 한도 남아있으면, 결제 승인 및 영수증 발행
        3. VAN 사에서 하루동안 승인 내역 보관하다 카드사(매입사)에 ‘매입’ 보냄. (그래서 당일 취소건은 당일 취소 가능한 것)
        4. 카드사는 매입된 정보로 월별 청구
        
    - PG
        - 가맹점에서 결제해도 PG사에서 결제 메일 옴. 카드사는 가맹점으로부터 결제 많이하면 수수료 적게냄. 여러 가맹점들의 부모 성격으로 가맹점들을 모아 대표로 결제하여 저렴한 카드 수수료 지불 가능하게 함
        ex) KG이니시스, NHN한국사이버결제, 토스페이먼츠, 카카오페이, 네이버페이
        네이버, 카카오는 회사 내 자체 PG 운영해서 `수수료 절감` + `거래액 직접 수령`하려 함
    - PG의 온라인 결제 구조
        
        ![image](https://github.com/user-attachments/assets/3fe2c879-438d-4c0d-9309-c7c958583ae1)

        1. VAN사의 단말기가 아닌, PG에서 시작
        2. PG에서 카드 정보 입력해 한도 조회 및 승인
        3. VAN 사에서 승인 내역 보유, 월별 카드사는 대금 받음
        4. 근데 카드사는 PG에 결제 2~3일 후 선지급함
        5. PG사도 종합몰(신세계몰)에 결제 2~3일 후 선지급. 중개플랫폼(오늘의집)은 구매확정 후 바로 지급해줌](attachment:3f468b00-1975-467b-97b7-14b8329695d1:image.png)
        
        1. VAN사의 단말기가 아닌, PG에서 시작
        2. PG에서 카드 정보 입력해 한도 조회 및 승인
        3. VAN 사에서 승인 내역 보유, 월별 카드사는 대금 받음
        4. 근데 카드사는 PG에 결제 2~3일 후 선지급함
        5. PG사도 종합몰(신세계몰)에 결제 2~3일 후 선지급. 중개플랫폼(오늘의집)은 구매확정 후 바로 지급해줌
        
    - 결제 가맹점 정보 얻기 어려움
        - 카드사 입장에서는 PG사만 찍히니 어디서 썼는지 알 수 없음 → 데이터 격차
        - 그래서 대형 커머스(쿠팡, 배민 등)들은 자체 페이서비스 만들어 `데이터 확보` + `수수료 절감`
    
# 결제 도메인 지식 - 결제 flow (with 판매, 결제, PG, 정산)
    
    ### 판매
    
    - 앱, POS, KIOSK 등 다양한 채널로부터 상품에 대한 결제 요청을 받음
        - 통합 장바구니로 상품 유형 무관하게 한번에 결제
    - 결제 API 호출
        - 결제 수단별 외부, 내부 결제 API 호출
    
    ### 결제
    
    - 인증
        - 카드사로부터 한도 남아있는지
    - 가격 계산
        - 카드 할인
    - 수단별 처리
        - 기프티콘/관람권/포인트/상품권 등
    - 결제 수단 API 호출
        - 카드사
        - 포인트/상품권
    
    ### PG
    
    - 온/오프라인 결제 요청들 VAN으로 전달
        - CJ올리브네트웍스 PG 활용. 아래처럼 정산도 되게끔
    
    ### 정산
    
    - 카드사 입금 관리, 가맹번호 한도 관리 등 온/오프라인 전체 정산 업무 담당
    - PG와 통합해서 PG에서 정산처리 → 정산 운영 비용 절감
    - 정산내역 → ERP(SAP) 전달
    - 직영, 가맹점 결제대금 지급일 당겨서 편의성 확보
    - 직영, 가맹점에 거래/정산 내역 제공
